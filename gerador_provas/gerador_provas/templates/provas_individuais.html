<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provas Geradas - Gerador de Provas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-input: #21262d;
            --border-color: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-green: #238636;
            --accent-red: #da3633;
            --accent-yellow: #d29922;
            --accent-blue: #58a6ff;
            --accent-purple: #a371f7;
            --accent-cyan: #39d353;
        }
        
        * {
            font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
        }
        
        body {
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            padding: 2rem;
        }
        
        /* Success Header */
        .success-header {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, rgba(35, 134, 54, 0.15), rgba(57, 211, 83, 0.1));
            border: 1px solid rgba(35, 134, 54, 0.3);
            border-radius: 16px;
            margin-bottom: 2rem;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            margin: 0 auto 1.5rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(35, 134, 54, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(35, 134, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(35, 134, 54, 0); }
        }
        
        .success-header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .success-header p {
            color: var(--text-secondary);
            margin: 0;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            display: block;
        }
        
        .stat-card.provas i { color: var(--accent-purple); }
        .stat-card.questoes i { color: var(--accent-blue); }
        .stat-card.tempo i { color: var(--accent-yellow); }
        .stat-card.zip i { color: var(--accent-green); }
        
        .stat-card h3 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 0.25rem;
        }
        
        .stat-card p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }
        
        /* Card */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background: transparent;
            border-bottom: 1px solid var(--border-color);
            padding: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-header h5 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        /* Download buttons */
        .btn-download-zip {
            background: linear-gradient(135deg, var(--accent-green), #2ea043);
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
        }
        
        .btn-download-zip:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(35, 134, 54, 0.4);
            color: white;
        }
        
        /* Provas list */
        .provas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .prova-item {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s;
        }
        
        .prova-item:hover {
            border-color: var(--accent-blue);
        }
        
        .prova-codigo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
        }
        
        .prova-info {
            flex: 1;
        }
        
        .prova-info h6 {
            margin: 0 0 0.25rem;
            font-weight: 600;
        }
        
        .prova-info small {
            color: var(--text-secondary);
        }
        
        .prova-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-icon {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-secondary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .btn-icon:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }
        
        .btn-icon.btn-gabarito:hover {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }
        
        /* Gabarito consolidado */
        .gabarito-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .gabarito-table th,
        .gabarito-table td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .gabarito-table th {
            background: var(--bg-input);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            color: var(--text-secondary);
        }
        
        .gabarito-table td {
            font-family: 'Fira Code', monospace;
        }
        
        .gabarito-table .codigo-prova {
            background: linear-gradient(135deg, rgba(163, 113, 247, 0.15), rgba(163, 113, 247, 0.05));
            font-weight: 600;
            color: var(--accent-purple);
        }
        
        .gabarito-resposta {
            background: var(--bg-input);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        /* Actions bar */
        .actions-bar {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .btn-secondary-custom {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .btn-secondary-custom:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }
        
        /* Alert */
        .alert-info {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
            color: var(--accent-blue);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        /* Scrollbar */
        .provas-grid::-webkit-scrollbar {
            width: 8px;
        }
        
        .provas-grid::-webkit-scrollbar-track {
            background: var(--bg-input);
            border-radius: 4px;
        }
        
        .provas-grid::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        .provas-grid::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Success Header -->
        <div class="success-header">
            <div class="success-icon">
                <i class="bi bi-check-lg"></i>
            </div>
            <h1>{{ resultado.provas_geradas }} Provas Geradas com Sucesso!</h1>
            <p>{{ resultado.titulo }} • Lote {{ resultado.lote_id }}</p>
        </div>
        
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card provas">
                <i class="bi bi-file-earmark-text"></i>
                <h3>{{ resultado.provas_geradas }}</h3>
                <p>Provas Únicas</p>
            </div>
            <div class="stat-card questoes">
                <i class="bi bi-list-ol"></i>
                <h3>{{ resultado.provas[0].num_questoes if resultado.provas else 0 }}</h3>
                <p>Questões por Prova</p>
            </div>
            <div class="stat-card tempo">
                <i class="bi bi-clock"></i>
                <h3>{{ "%.1f"|format(resultado.tempo_geracao_seg) }}s</h3>
                <p>Tempo de Geração</p>
            </div>
            <div class="stat-card zip">
                <i class="bi bi-file-earmark-zip"></i>
                <h3>{{ resultado.provas_geradas * 2 }}</h3>
                <p>Arquivos PDF</p>
            </div>
        </div>
        
        <!-- Download ZIP -->
        {% if resultado.caminho_zip %}
        <div class="text-center mb-4">
            <a href="/download/zip/{{ resultado.caminho_zip|basename }}" class="btn btn-download-zip">
                <i class="bi bi-download"></i>
                Baixar Todas as Provas (ZIP)
            </a>
        </div>
        {% endif %}
        
        <!-- Info -->
        <div class="alert alert-info mb-4">
            <i class="bi bi-info-circle"></i>
            <div>
                Cada prova possui questões e alternativas em ordens diferentes, 
                dificultando a cópia entre alunos. Cada prova tem seu próprio gabarito.
            </div>
        </div>
        
        <!-- Lista de Provas -->
        <div class="card">
            <div class="card-header">
                <h5>
                    <i class="bi bi-files"></i>
                    Provas Individuais
                </h5>
                <span class="badge bg-primary">{{ resultado.provas_geradas }} provas</span>
            </div>
            <div class="card-body">
                <div class="provas-grid">
                    {% for prova in resultado.provas %}
                    <div class="prova-item">
                        <div class="prova-codigo">{{ prova.codigo_prova }}</div>
                        <div class="prova-info">
                            <h6>Prova {{ prova.codigo_prova }}</h6>
                            <small>Aluno #{{ prova.numero_aluno }}</small>
                        </div>
                        <div class="prova-actions">
                            {% if prova.caminho_pdf %}
                            <a href="/download/pdf/{{ prova.caminho_pdf|basename }}" 
                               class="btn-icon" title="Baixar Prova">
                                <i class="bi bi-file-pdf"></i>
                            </a>
                            {% endif %}
                            {% if prova.caminho_gabarito %}
                            <a href="/download/pdf/{{ prova.caminho_gabarito|basename }}" 
                               class="btn-icon btn-gabarito" title="Baixar Gabarito">
                                <i class="bi bi-key"></i>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Gabarito Consolidado -->
        <div class="card">
            <div class="card-header">
                <h5>
                    <i class="bi bi-table"></i>
                    Gabarito Consolidado
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="gabarito-table">
                        <thead>
                            <tr>
                                <th>Código</th>
                                {% for i in range(1, (resultado.provas[0].num_questoes or 0) + 1) %}
                                <th>Q{{ i }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for codigo, dados in resultado.gabarito_consolidado.items() %}
                            <tr>
                                <td class="codigo-prova">{{ codigo }}</td>
                                {% for num, resposta in dados.gabarito.items() %}
                                <td><span class="gabarito-resposta">{{ resposta }}</span></td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Actions -->
        <div class="actions-bar">
            <a href="/banco-questoes" class="btn-secondary-custom">
                <i class="bi bi-database"></i>
                Banco de Questões
            </a>
            <a href="/montar-prova" class="btn-secondary-custom">
                <i class="bi bi-plus-lg"></i>
                Nova Prova
            </a>
            <a href="/" class="btn-secondary-custom">
                <i class="bi bi-house"></i>
                Início
            </a>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

